@using Sector45_Bank.Data;
@using Sector45_Bank.Models;
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}





<div class="container" style="margin-top:100px">
    <div class="row">
        <div class="col-md-12">
            <div id="my-carousel" class="carousel slide" data-ride="carousel">
                <div class="carousel-inner" role="listbox">
                    @if (Tkn.accounts != null)
                    {
                        var i = 1;
                        foreach (Account account in Tkn.accounts)
                        {
                            if (!account.isActive)
                            {
                                continue;
                            }
                            if (i == 1)
                            {
                                <div id="@account.accountNo" class="card-container centermx drop-shadow lifted item active">
                                    <div class="card">
                                        <div class="card-header ">
                                            <p align="center">@account.accountNo</p><span name="@account.accountNo" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                                        </div>
                                        <div class="card-body">
                                            <p>Balance</p><hr />
                                            <p>@account.balance</p>
                                        </div>
                                        <div class="card-footer condensed">
                                            <p><button type="button" class="btn btn-primary accTran" name="@account.accountNo">Account Transactions</button></p>
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div id="@account.accountNo" class="card-container centermx drop-shadow lifted item">
                                    <div class="card">
                                        <div class="card-header ">
                                            <p align="center">@account.accountNo</p><span name="@account.accountNo" class="delete glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                                        </div>
                                        <div class="card-body">
                                            <p>Balance</p><hr />
                                            <p>@account.balance</p>
                                        </div>
                                        <div class="card-footer condensed">
                                            <p><button type="button" class="btn btn-primary accTran" name="@account.accountNo">Account Transactions</button></p>
                                        </div>
                                    </div>
                                </div>
                            }
                            i++;
                        }
                    }

                </div>

                <a class="left carousel-control" href="#my-carousel" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="right carousel-control" href="#my-carousel" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>
    </div>
</div>
@if (Tkn.operations != null)
{
    if (Tkn.operations.Count != 0)
    {
        <table id="table" class="table table-dark">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Transactions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (Operation item in Tkn.operations)
                {
                    <tr>
                        <th scope="row">-</th>
                        <td>Amount:@item.amount.ToString()</td>
                        <td>Date:@item.date.ToShortDateString()</td>
                        @if (item.isDeposit)
                        {
                            <td>Deposit</td>
                        }
                        else
                        {
                            <td>Withdrawal</td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    }
    else { <p style="text-align:center">No records found for the selected account!</p>}

}



<script>
    $(function () {
        $(".delete").click(function () {
            if (@Tkn.accounts.Count> 1) {
                var result = window.confirm("Do you approve the deletion of the account?");
                if (result) {
                    $.ajax({
                        type: 'POST',
                        url: '/Account/remove/',
                        data: { no: this.getAttribute("name") },
                        success: function () {
                            $.ajax({
                                type: 'GET',
                                url: '/Account/account',
                                success: function () {
                                    window.location = "/Membership/Index/";
                                }
                            });
                        },
                        error: function () {
                            alert("Failed to deletion account!");
                        }
                    });
                } else {

                }
            }
        });
    });
    $(".accTran").click(function () {
        var cardNo = this.getAttribute("name");
        $.ajax({
            type: 'POST',
            url: '/Account/transaction/',
            data: { no: cardNo },
            success: function () {
                window.location = "http://localhost:62533/Membership";
            },
            error: function () {
                alert("Can't get dashboard");
            }
        });
    });
</script>